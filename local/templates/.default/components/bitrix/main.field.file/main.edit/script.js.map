{"version":3,"file":"script.js","sources":["src/components/inputmanager.js","src/components/main.js","src/app.js"],"sourcesContent":["// inputmanager.js\nexport const InputManager = {\n  name: \"InputManager\",\n  props: {\n    controlId: { type: String, required: true },\n    controlName: { type: String, required: true }, // e.g. \"UF_CRM_XXXXX\"\n    multiple: { type: Boolean, required: true },\n    filledValues: { type: Array, default: () => [] }, // initial tokens\n  },\n  data() {\n    return {\n      // keep as strings to avoid 291 === \"291\" mismatches\n      values: Array.isArray(this.filledValues)\n        ? this.filledValues.map(String)\n        : [],\n      deletedValues: [],\n    };\n  },\n  methods: {\n    fireChange() {\n      // notify Bitrix editor that hidden inputs changed\n      BX.fireEvent(this.$refs.valueChanger, \"change\");\n    },\n\n    // Replace the token list (already ordered & deduped by caller)\n    setValues(newValues) {\n      const next = Array.from(newValues || []).map(String);\n      const prev = this.values;\n      this.values = next;\n      if (!this.arraysAreEqual(prev, this.values)) this.fireChange();\n    },\n\n    // Reorder-only variant (same semantics as setValues)\n    updateOrder(newOrder) {\n      const next = Array.from(newOrder || []).map(String);\n      const prev = this.values;\n      this.values = next;\n      if (!this.arraysAreEqual(prev, this.values)) this.fireChange();\n    },\n\n    addDeleted(fileToken) {\n      const t = String(fileToken);\n      this.deletedValues = [...this.deletedValues, t];\n      this.fireChange();\n    },\n\n    removeValue(fileToken) {\n      const t = String(fileToken);\n      const idx = this.values.indexOf(t);\n      if (idx > -1) {\n        this.values.splice(idx, 1);\n        this.fireChange();\n      }\n    },\n\n    arraysAreEqual(a, b) {\n      if (!Array.isArray(a) || !Array.isArray(b)) return false;\n      if (a.length !== b.length) return false;\n      for (let i = 0; i < a.length; i++) {\n        if (a[i] !== b[i]) return false;\n      }\n      return true;\n    },\n  },\n\n  template: `\n    <input ref=\"valueChanger\" type=\"hidden\" />\n    <div class=\"uf-hidden-inputs\" style=\"display: none;\">\n      <!-- tokens -->\n      <div v-if=\"values.length\">\n        <input\n          v-if=\"multiple\"\n          v-for=\"(val, i) in values\"\n          :key=\"'v-'+i\"\n          type=\"hidden\"\n          :name=\"controlName + '[]'\"\n          :value=\"val\"\n        />\n        <input\n          v-else\n          type=\"hidden\"\n          :name=\"controlName\"\n          :value=\"values[values.length - 1]\"\n        />\n      </div>\n      <div v-else>\n        <input type=\"hidden\" :name=\"multiple ? controlName + '[]' : controlName\" />\n      </div>\n\n      <!-- deletions -->\n      <div v-if=\"deletedValues.length\">\n        <input\n          v-if=\"multiple\"\n          v-for=\"(val, i) in deletedValues\"\n          :key=\"'d1-'+i\"\n          type=\"hidden\"\n          :name=\"controlName + '_del[]'\"\n          :value=\"val\"\n        />\n        <input\n          v-else\n          type=\"hidden\"\n          :name=\"controlName + '_del'\"\n          :value=\"deletedValues[0]\"\n        />\n        <input\n          v-for=\"(val, i) in deletedValues\"\n          :key=\"'d2-'+i\"\n          type=\"hidden\"\n          :name=\"controlId + '_deleted[]'\"\n          :value=\"val\"\n        />\n      </div>\n    </div>\n  `,\n};\n","// main.js\nimport { Type } from \"main.core\";\nimport { defineComponent, ref, computed, onMounted, nextTick } from \"ui.vue3\";\nimport { TileWidgetComponent } from \"ui.uploader.tile-widget\";\nimport { InputManager } from \"./inputmanager\";\n\n/* ---------------- helpers ---------------- */\nconst toExt = (n) => (n ? String(n).split(\".\").pop().toLowerCase() : \"\");\nconst tokenOf = (f) => (f && (f.signedFileId || f.id)) || \"\";\n\n/* ---------------- Custom Tile (drag/drop + upload) ---------------- */\nconst CustomTileWidget = {\n  name: \"CustomTileWidget\",\n  props: {\n    files: { type: Array, default: () => [] },\n    readonly: { type: Boolean, default: false },\n  },\n  emits: [\"reorder\", \"remove\", \"upload\"],\n  setup(props, { emit }) {\n    const draggedIndex = ref(null);\n    const dragOverIndex = ref(null);\n    const cssUrl = (u) => (u ? `url(\"${u}\")` : \"\");\n    const getFileIcon = (ext) => {\n      const m = {\n        pdf: \"üìÑ\",\n        doc: \"üìù\",\n        docx: \"üìù\",\n        xls: \"üìä\",\n        xlsx: \"üìä\",\n        ppt: \"üìä\",\n        pptx: \"üìä\",\n        jpg: \"üñºÔ∏è\",\n        jpeg: \"üñºÔ∏è\",\n        png: \"üñºÔ∏è\",\n        gif: \"üñºÔ∏è\",\n        svg: \"üñºÔ∏è\",\n        webp: \"üñºÔ∏è\",\n        mp4: \"üé•\",\n        mp3: \"üéµ\",\n        zip: \"üóúÔ∏è\",\n        rar: \"üóúÔ∏è\",\n        txt: \"üìÑ\",\n      };\n      return m[(ext || \"\").toLowerCase()] || \"üìÅ\";\n    };\n\n    const handleDragStart = (e, i) => {\n      if (props.readonly) return;\n      draggedIndex.value = i;\n      e.dataTransfer.effectAllowed = \"move\";\n      e.dataTransfer.setData(\"text/plain\", String(i));\n      e.currentTarget.style.opacity = \"0.5\";\n    };\n    const handleDragOver = (e, i) => {\n      if (props.readonly) return;\n      e.preventDefault();\n      dragOverIndex.value = i;\n      e.dataTransfer.dropEffect = \"move\";\n    };\n    const handleDrop = (e, i) => {\n      if (props.readonly) return;\n      e.preventDefault();\n      const from = draggedIndex.value;\n      if (from === null || from === i) return reset();\n      const list = props.files.slice();\n      const [moved] = list.splice(from, 1);\n      list.splice(i, 0, moved);\n      emit(\"reorder\", list);\n      reset();\n    };\n    const handleDragEnd = (e) => {\n      e.currentTarget.style.opacity = \"1\";\n      reset();\n    };\n    const reset = () => {\n      draggedIndex.value = null;\n      dragOverIndex.value = null;\n    };\n\n    const removeFile = (id) => {\n      if (!props.readonly) emit(\"remove\", id);\n    };\n    const handleFileUpload = (e) => {\n      if (props.readonly) return;\n      const files = e.target.files;\n      if (files && files.length) emit(\"upload\", files);\n      e.target.value = \"\";\n    };\n    const handleDropUpload = (e) => {\n      if (props.readonly) return;\n      e.preventDefault();\n      const files = e.dataTransfer.files;\n      if (files && files.length) emit(\"upload\", files);\n    };\n\n    return {\n      draggedIndex,\n      dragOverIndex,\n      cssUrl,\n      getFileIcon,\n      handleDragStart,\n      handleDragOver,\n      handleDrop,\n      handleDragEnd,\n      removeFile,\n      handleFileUpload,\n      handleDropUpload,\n    };\n  },\n  template: `\n    <div class=\"custom-tile-widget\">\n    <div class=\"custom-container\">\n      <div v-for=\"(file, index) in files\"\n           :key=\"(file.signedFileId || file.id || index) + ':' + index\"\n           class=\"tile-item\"\n           :class=\"{\n             'drag-over': dragOverIndex===index,\n             'dragging': draggedIndex===index,\n             'uploading': file.uploadStatus==='uploading',\n             'upload-failed': file.uploadStatus==='failed'\n           }\"\n           :draggable=\"!readonly && file.uploadStatus!=='uploading'\"\n           @dragstart=\"handleDragStart($event, index)\"\n           @dragover=\"handleDragOver($event, index)\"\n           @drop=\"handleDrop($event, index)\"\n           @dragend=\"handleDragEnd\">\n        <div class=\"tile-content\">\n          <button v-if=\"!readonly && file.uploadStatus!=='uploading'\"\n                  class=\"tile-remove\" @click=\"removeFile(file.id)\" title=\"Remove file\">√ó</button>\n\n          <div v-if=\"file.uploadStatus==='uploading'\" class=\"upload-progress\">\n            <div class=\"progress-bar\" :style=\"{ width: (file.progress||0) + '%' }\"></div>\n            <div class=\"progress-text\">{{ file.progress || 0 }}%</div>\n          </div>\n\n          <div class=\"tile-preview\">\n            <div v-if=\"file.src && file.isImage\"\n                 class=\"tile-image\"\n                 :style=\"{ backgroundImage: cssUrl(file.src) }\"\n                 :title=\"file.name\"></div>\n            <div v-else class=\"tile-icon\">\n              <div class=\"file-type-icon\">{{ getFileIcon(file.extension) }}</div>\n              <span v-if=\"file.extension\" class=\"file-ext\">{{ file.extension.toUpperCase() }}</span>\n            </div>\n          </div>\n\n          <div class=\"tile-info\">\n            <div class=\"tile-name\" :title=\"file.name\">{{ file.name }}</div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"upload-zone\" v-if=\"!readonly\">\n        <input type=\"file\" multiple @change=\"handleFileUpload\" style=\"display:none\" ref=\"fileInput\" />\n        <div class=\"drop-area\"\n             @click=\"$refs.fileInput.click()\"\n             @dragover.prevent @dragenter.prevent\n             @drop.prevent=\"handleDropUpload\">\n          <div class=\"drop-content\">\n            <div class=\"drop-icon\">üìÅ</div>\n            <p class=\"drop-text\">Drop files here<br>or click to upload</p>\n          </div>\n        </div>\n      </div>\n      </div>\n    </div>\n  `,\n};\n\n/* ---------------- Main ---------------- */\nexport const Main = defineComponent({\n  name: \"Main\",\n  components: { InputManager, TileWidgetComponent, CustomTileWidget },\n  props: {\n    controlId: { type: String, required: true },\n    context: { type: Object, required: true }, // { entityId, fieldName, multiple, readonly }\n    filledValues: { type: Array, default: () => [] }, // numeric ids OR signed ids\n    fileDetails: { type: Array, default: () => [] }, // [{id,name,src,extension,signedFileId,...}]\n  },\n  setup(props) {\n    const uploaderRef = ref(null);\n    const inputMgrRef = ref(null);\n    const fileData = ref([]);\n    const errorMessage = ref(\"\");\n\n    const MAX_FILES = 20;\n    const fileTokens = ref([...(props.filledValues || [])]);\n\n    const pushTokensToInput = () => {\n      const tokens = [];\n      const seen = new Set();\n      for (const f of fileData.value) {\n        if (f.uploadStatus !== \"completed\") continue;\n        const t = tokenOf(f);\n        if (!t) continue;\n        const k = String(t);\n        if (!seen.has(k)) {\n          seen.add(k);\n          tokens.push(t);\n        }\n      }\n      console.log(\"[pushTokensToInput] tokens ‚Üí\", tokens);\n      fileTokens.value = tokens;\n      inputMgrRef.value?.setValues(tokens);\n    };\n\n    /** Load BX files' metadata first, then build tiles */\n    const syncFromBx = async () => {\n      const bx = uploaderRef.value?.uploader;\n      if (!bx) {\n        console.log(\"[syncFromBx] BX uploader not ready yet\");\n        return;\n      }\n      const bxFiles = bx.getFiles?.() || [];\n      console.log(\"[syncFromBx] bx.getFiles()\", bxFiles.length, bxFiles);\n\n      // 1) Ensure metadata is fetched\n      const loaders = [];\n      bxFiles.forEach((file, i) => {\n        const hasLoad = typeof file?.load === \"function\";\n        console.log(\n          `[syncFromBx] #${i} isComplete=${file?.isComplete?.()} hasLoad=${hasLoad}`,\n        );\n        if (hasLoad) {\n          try {\n            const p = file.load().catch((e) => {\n              console.warn(`[syncFromBx] load() failed for #${i}`, e);\n            });\n            loaders.push(p);\n          } catch (e) {\n            console.warn(`[syncFromBx] load() threw for #${i}`, e);\n          }\n        }\n      });\n      if (loaders.length) {\n        console.log(`[syncFromBx] awaiting ${loaders.length} load() calls...`);\n        await Promise.allSettled(loaders);\n      }\n\n      // 2) Build completed tiles (name/preview should be available now)\n      const completed = [];\n      const seenTok = new Set();\n\n      bxFiles.forEach((file, idx) => {\n        // after load() Bitrix often marks as \"server\" (not strictly \"complete\"),\n        // so rely on having IDs + name instead of isComplete only\n        const real = file.getCustomData?.()?.realFileId;\n        const id = Number.isFinite(real) ? real : file.getServerFileId?.();\n        const name = file.getName?.() || `File ${id}`;\n        const ext = toExt(name);\n        const previewUrl = file.getPreviewUrl?.() || \"\";\n        const downloadUrl = file.getDownloadUrl?.() || \"\";\n        const signed = file.getSignedFileId?.() || null;\n        const token = signed || id;\n\n        const isImageExt = [\n          \"jpg\",\n          \"jpeg\",\n          \"png\",\n          \"gif\",\n          \"webp\",\n          \"svg\",\n          \"bmp\",\n        ].includes(ext);\n        let finalSrc = previewUrl || (isImageExt ? downloadUrl : \"\");\n\n        console.log(\"[syncFromBx] resolved\", {\n          idx,\n          id,\n          name,\n          ext,\n          signed,\n          previewUrl,\n          downloadUrl,\n          finalSrc,\n          hasPreviewMethod: !!file.getPreviewUrl,\n          hasDownloadMethod: !!file.getDownloadUrl,\n        });\n\n        if (token == null || seenTok.has(String(token))) return;\n        seenTok.add(String(token));\n\n        // Check if this file is already in fileData as an uploading tile\n        const existingIndex = fileData.value.findIndex(f => \n          String(f.id) === String(id) || \n          (f.uploadStatus === \"uploading\" && f.name === name)\n        );\n\n        const fileEntry = {\n          id,\n          name,\n          src: finalSrc || \"\",\n          isImage: isImageExt && !!finalSrc,\n          extension: ext,\n          uploadStatus: \"completed\",\n          progress: 100,\n          signedFileId: signed || null,\n        };\n\n        if (existingIndex > -1) {\n          // Update existing uploading tile to completed\n          console.log(\"[syncFromBx] updating existing tile\", { existingIndex, name, id });\n          fileData.value[existingIndex] = fileEntry;\n        } else {\n          // Add as new completed tile\n          completed.push(fileEntry);\n        }\n      });\n\n      // keep uploading tiles that weren't matched/updated\n      const inflight = fileData.value.filter(\n        (f) =>\n          f.uploadStatus !== \"completed\" && !seenTok.has(String(tokenOf(f))),\n      );\n\n      // Only add new completed tiles (not the updated ones which are already in fileData)\n      fileData.value = [...fileData.value.filter(f => f.uploadStatus === \"completed\"), ...completed, ...inflight];\n      console.log(\"[syncFromBx] fileData ‚Üí\", fileData.value);\n      pushTokensToInput();\n\n      // Check if we have files but no proper previews/names - retry after delay\n      const hasFilesWithoutProperData = completed.some(f => \n        (!f.src && f.isImage) || f.name.startsWith('File ')\n      );\n      \n      if (hasFilesWithoutProperData && !window._syncRetryInProgress) {\n        console.log(\"[syncFromBx] Detected files without proper previews, scheduling retry...\");\n        window._syncRetryInProgress = true;\n        setTimeout(async () => {\n          console.log(\"[syncFromBx] Retry attempt - reloading file metadata...\");\n          await syncFromBx();\n          window._syncRetryInProgress = false;\n        }, 1000); // Wait 1 second for Bitrix to fully initialize\n      }\n    };    const uploaderOptions = computed(() => ({\n      controller: \"main.fileUploader.fieldFileUploaderController\",\n  // Pass full context to let Bitrix controller hydrate existing tokens\n  controllerOptions: props.context,\n      files: fileTokens.value,\n      multiple: !!props.context?.multiple,\n      autoUpload: true,\n      treatOversizeImageAsFile: true,\n      events: {\n        \"File:onAdd\": (ev) => {\n          const bxFile = ev?.getData?.()?.file;\n          const name = bxFile?.getName?.();\n          if (!bxFile || !name) return;\n          for (let i = fileData.value.length - 1; i >= 0; i--) {\n            const f = fileData.value[i];\n            if (f.uploadStatus === \"uploading\" && f.name === name) {\n              const newId = bxFile.getId?.() || bxFile.getServerFileId?.();\n              f.id = newId;\n              f.progress = 0;\n              console.log(\"[onAdd] temp‚ÜíBX id\", { name, newId });\n              break;\n            }\n          }\n        },\n        \"File:onProgress\": (ev) => {\n          const file = ev?.getData?.()?.file;\n          if (!file) return;\n          const id = file.getId?.() || file.getServerFileId?.();\n          const idx = fileData.value.findIndex(\n            (x) => String(x.id) === String(id),\n          );\n          if (idx > -1)\n            fileData.value[idx].progress = file.getProgress?.() || 0;\n        },\n        \"File:onUploadComplete\": () => {\n          console.log(\"[onUploadComplete]\");\n          setTimeout(syncFromBx, 0);\n        },\n        onUploadComplete: () => {\n          console.log(\"[onUploadComplete (alt)]\");\n          setTimeout(syncFromBx, 0);\n        },\n        \"File:onRemove\": (ev) => {\n          const file = ev?.getData?.()?.file;\n          if (!file) return;\n          const serverId = file.getServerFileId?.();\n          const realId = file.getCustomData?.()?.realFileId;\n          const rmToken = String(Number.isFinite(realId) ? realId : serverId);\n          console.log(\"[onRemove] token\", rmToken);\n          inputMgrRef.value?.addDeleted(rmToken);\n          fileData.value = fileData.value.filter(\n            (f) =>\n              String(tokenOf(f)) !== rmToken &&\n              String(f.id) !== String(file.getId?.()),\n          );\n          pushTokensToInput();\n        },\n      },\n    }));\n\n    /* ---------------- UI handlers ---------------- */\n    const handleUpload = (fileList) => {\n      const bx = uploaderRef.value?.uploader;\n      if (!bx || !fileList) return;\n\n      // Clear previous error messages\n      errorMessage.value = \"\";\n\n      const filesToUpload = [...fileList];\n      const currentFileCount = fileData.value.length;\n      const totalAfterUpload = currentFileCount + filesToUpload.length;\n\n      // Check if adding these files would exceed the limit\n      if (totalAfterUpload > MAX_FILES) {\n        const allowed = Math.max(0, MAX_FILES - currentFileCount);\n        errorMessage.value = `Maximum ${MAX_FILES} files allowed. You can only upload ${allowed} more file(s).`;\n        console.warn(\"[handleUpload] File limit exceeded\", {\n          current: currentFileCount,\n          trying: filesToUpload.length,\n          max: MAX_FILES,\n          allowed\n        });\n        \n        // Clear the error message after 5 seconds\n        setTimeout(() => {\n          errorMessage.value = \"\";\n        }, 5000);\n        \n        return;\n      }\n\n      filesToUpload.forEach((f) => {\n        const tmpId = `tmp_${Date.now()}_${Math.random()\n          .toString(36)\n          .slice(2)}`;\n        const ext = toExt(f.name);\n        const isImage =\n          f.type?.startsWith(\"image/\") ||\n          [\"jpg\", \"jpeg\", \"png\", \"gif\", \"webp\", \"svg\", \"bmp\"].includes(ext);\n\n        let previewSrc = \"\";\n        if (isImage && f.type?.startsWith(\"image/\")) {\n          try {\n            previewSrc = URL.createObjectURL(f);\n          } catch {}\n        }\n\n        console.log(\"[handleUpload] temp tile\", {\n          name: f.name,\n          ext,\n          isImage,\n          previewSrc,\n        });\n\n        fileData.value.push({\n          id: tmpId,\n          name: f.name,\n          size: f.size,\n          src: previewSrc,\n          isImage,\n          extension: ext,\n          uploadStatus: \"uploading\",\n          progress: 0,\n        });\n        bx.addFile(f);\n      });\n    };\n\n    const handleReorder = (reordered) => {\n      const seen = new Set();\n      const completed = [];\n      const inflight = [];\n      for (const f of reordered) {\n        if (f.uploadStatus !== \"completed\") {\n          inflight.push(f);\n          continue;\n        }\n        const t = tokenOf(f);\n        if (!t) continue;\n        const k = String(t);\n        if (!seen.has(k)) {\n          seen.add(k);\n          completed.push(f);\n        }\n      }\n      fileData.value = [\n        ...completed.map((f) => ({ ...f })),\n        ...inflight.map((f) => ({ ...f })),\n      ];\n      nextTick(pushTokensToInput);\n      nextTick(() => inputMgrRef.value?.updateOrder(fileTokens.value));\n    };\n\n    const handleRemove = (fileId) => {\n      const bx = uploaderRef.value?.uploader;\n      if (bx) {\n        const f = bx\n          .getFiles()\n          .find(\n            (ff) =>\n              String(ff.getServerFileId?.()) === String(fileId) ||\n              String(ff.getId?.()) === String(fileId),\n          );\n        if (f) bx.removeFile(f);\n      }\n      const removed = fileData.value.find(\n        (f) => String(f.id) === String(fileId),\n      );\n      fileData.value = fileData.value.filter(\n        (f) => String(f.id) !== String(fileId),\n      );\n      inputMgrRef.value?.addDeleted(\n        removed ? removed.signedFileId || removed.id : fileId,\n      );\n      pushTokensToInput();\n    };\n\n    /* ---------------- lifecycle ---------------- */\n    onMounted(() => {\n      if (Type.isArrayFilled(props.fileDetails)) {\n        fileData.value = props.fileDetails.map((f) => ({\n          id: f.id,\n          name: f.name,\n          src: f.src || \"\",\n          isImage: !!f.src,\n          extension: toExt(f.name || \"\"),\n          uploadStatus: \"completed\",\n          progress: 100,\n          signedFileId: f.signedFileId || null,\n        }));\n        console.log(\"[onMounted] boot from fileDetails\", fileData.value);\n        pushTokensToInput();\n      } else {\n        console.log(\"[onMounted] No fileDetails provided, will use Bitrix sync\");\n      }\n\n      nextTick(() => {\n        console.log(\n          \"[onMounted] seed InputManager with tokens\",\n          fileTokens.value,\n        );\n        inputMgrRef.value?.setValues(fileTokens.value);\n      });\n\n      // Poll BX a bit, then force a metadata load+sync\n      let tries = 0;\n      const maxTries = 40; // ~4s\n      const poll = async () => {\n        const bx = uploaderRef.value?.uploader;\n        const list = bx?.getFiles?.() || [];\n        console.log(\n          `[poll] bx_ready=${!!bx} files=${list.length} try=${tries}`,\n        );\n\n        // TEMPORARILY DISABLED - Skip Bitrix sync to test our mock data\n        // if (fileData.value.length > 0) {\n        //   console.log(\"[poll] Using test data, skipping BX sync\");\n        //   return;\n        // }\n\n        if (!bx || (props.filledValues?.length && list.length === 0)) {\n          if (tries++ < maxTries) return void setTimeout(poll, 100);\n        }\n\n        await syncFromBx();\n\n        if (\n          fileData.value.length === 0 &&\n          props.filledValues?.length &&\n          tries < maxTries\n        ) {\n          return void setTimeout(poll, 200);\n        }\n      };\n      setTimeout(poll, 0);\n\n      const valueChanger = inputMgrRef.value?.$refs.valueChanger;\n      const form = valueChanger?.closest?.(\"form\");\n      if (form) {\n        form.addEventListener(\n          \"submit\",\n          (e) => {\n            const pending = fileData.value.some(\n              (f) => f.uploadStatus === \"uploading\",\n            );\n            if (pending) {\n              console.warn(\"[submit] blocked: uploads pending\");\n              e.preventDefault();\n              return;\n            }\n            console.log(\"[submit] commit tokens\");\n            pushTokensToInput();\n          },\n          { capture: true },\n        );\n      }\n    });\n\n    return {\n      uploaderRef,\n      inputMgrRef,\n      fileData,\n      fileTokens,\n      uploaderOptions,\n      handleUpload,\n      handleReorder,\n      handleRemove,\n      context: props.context,\n      errorMessage,\n    };\n  },\n  template: `\n    <div class=\"main-field-file-wrapper\">\n      <InputManager\n        ref=\"inputMgrRef\"\n        :controlId=\"controlId\"\n        :controlName=\"context.fieldName\"\n        :multiple=\"context.multiple\"\n        :filledValues=\"filledValues\"\n      />\n\n      <!-- Hidden Bitrix uploader (engine only) -->\n      <TileWidgetComponent\n        ref=\"uploaderRef\"\n        :uploaderOptions=\"uploaderOptions\"\n        style=\"display:none\"\n      />\n\n      <!-- Visible custom tiles -->\n      <CustomTileWidget\n        :files=\"fileData\"\n        :readonly=\"context.readonly || false\"\n        @upload=\"handleUpload\"\n        @reorder=\"handleReorder\"\n        @remove=\"handleRemove\"\n      />\n\n      <!-- Error message display -->\n      <div v-if=\"errorMessage\" class=\"file-upload-error\" style=\"color: #d32f2f; background: #ffebee; padding: 8px 12px; border-radius: 4px; margin-top: 8px; border-left: 3px solid #d32f2f;\">\n        {{ errorMessage }}\n      </div>\n\n      <div v-if=\"!fileData.length\" class=\"no-files-message\">No files uploaded yet.</div>\n    </div>\n  `,\n});\n\nexport { Main as default };\n","import { Type } from 'main.core';\nimport { BitrixVue, VueCreateAppResult } from 'ui.vue3';\nimport { Main, AppContext } from './components/main';\n\ndeclare type AppConstructorParams = {\n\tcontainerId: string,\n\tcontext: AppContext,\n\tvalue: Array,\n};\n\nexport class App\n{\n\t#controlId: string;\n\t#container: HTMLElement;\n\t#context: AppContext;\n\t#value: Array;\n\n\t#app: ?VueCreateAppResult = null;\n\n\tconstructor(params: AppConstructorParams)\n\t{\n\t\tthis.#controlId = params.controlId;\n\t\tthis.#container = document.getElementById(params.containerId);\n\n\t\tif (!Type.isDomNode(this.#container))\n\t\t{\n\t\t\tthrow new Error('container not found');\n\t\t}\n\t\t\n\t\tthis.#context = params.context;\n\t\tthis.#value = params.value.map((value) => { return parseInt(value); });\n\t}\n\n\tstart(): void\n\t{\n\t\tthis.#app = BitrixVue.createApp(\n\t\t\t{\n\t\t\t\t...Main\n\t\t\t},\n\t\t\t{\n\t\t\t\tcontrolId: this.#controlId,\n\t\t\t\tcontainer: this.#container,\n\t\t\t\tcontext: this.#context,\n\t\t\t\tfilledValues: this.#value,\n\t\t\t},\n\t\t);\n\n\t\tthis.#app.mount(this.#container);\n\t}\n\n\tstop(): void\n\t{\n\t\tthis.#app.unmount();\n\n\t\tthis.#app = null;\n\t}\n}\n"],"names":["InputManager","name","props","controlId","type","String","required","controlName","multiple","Boolean","filledValues","Array","data","values","isArray","map","deletedValues","methods","fireChange","BX","fireEvent","$refs","valueChanger","setValues","newValues","next","from","prev","arraysAreEqual","updateOrder","newOrder","addDeleted","fileToken","t","removeValue","idx","indexOf","splice","a","b","length","i","template","toExt","n","split","pop","toLowerCase","tokenOf","f","signedFileId","id","CustomTileWidget","files","readonly","emits","setup","emit","draggedIndex","ref","dragOverIndex","cssUrl","u","getFileIcon","ext","m","pdf","doc","docx","xls","xlsx","ppt","pptx","jpg","jpeg","png","gif","svg","webp","mp4","mp3","zip","rar","txt","handleDragStart","e","value","dataTransfer","effectAllowed","setData","currentTarget","style","opacity","handleDragOver","preventDefault","dropEffect","handleDrop","reset","list","slice","moved","handleDragEnd","removeFile","handleFileUpload","target","handleDropUpload","Main","defineComponent","components","TileWidgetComponent","context","Object","fileDetails","uploaderRef","inputMgrRef","fileData","errorMessage","MAX_FILES","fileTokens","pushTokensToInput","tokens","seen","Set","uploadStatus","k","has","add","push","console","log","syncFromBx","bx","uploader","bxFiles","getFiles","loaders","forEach","file","hasLoad","load","isComplete","p","warn","Promise","allSettled","completed","seenTok","real","getCustomData","realFileId","Number","isFinite","getServerFileId","getName","previewUrl","getPreviewUrl","downloadUrl","getDownloadUrl","signed","getSignedFileId","token","isImageExt","includes","finalSrc","hasPreviewMethod","hasDownloadMethod","existingIndex","findIndex","fileEntry","src","isImage","extension","progress","inflight","filter","hasFilesWithoutProperData","some","startsWith","window","_syncRetryInProgress","setTimeout","uploaderOptions","computed","controller","controllerOptions","autoUpload","treatOversizeImageAsFile","events","ev","bxFile","getData","newId","getId","x","getProgress","onUploadComplete","serverId","realId","rmToken","handleUpload","fileList","filesToUpload","currentFileCount","totalAfterUpload","allowed","Math","max","current","trying","tmpId","Date","now","random","toString","previewSrc","URL","createObjectURL","size","addFile","handleReorder","reordered","nextTick","handleRemove","fileId","find","ff","removed","onMounted","Type","isArrayFilled","tries","maxTries","poll","form","closest","addEventListener","pending","capture","App","params","document","getElementById","containerId","isDomNode","Error","parseInt","BitrixVue","createApp","container","mount","unmount"],"mappings":"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"}